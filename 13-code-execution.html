<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAM & Study Load Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #0f3460 0%, #533483 100%);
            color: white;
            padding: 35px 30px;
            text-align: center;
            position: relative;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #e94560, #f5a623, #0f3460);
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .header p {
            opacity: 0.85;
            font-size: 1rem;
            font-weight: 300;
        }

        .badge-row {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 14px;
            flex-wrap: wrap;
        }

        .badge {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.25);
            border-radius: 20px;
            padding: 4px 12px;
            font-size: 0.75rem;
            font-weight: 500;
            letter-spacing: 0.3px;
        }

        .api-key-section {
            padding: 18px 30px;
            background: #f7f8fc;
            border-bottom: 1px solid #e8eaf0;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .api-key-section label {
            font-size: 0.85rem;
            font-weight: 600;
            color: #444;
            white-space: nowrap;
        }

        #apiKeyInput {
            flex: 1;
            min-width: 200px;
            padding: 9px 14px;
            border: 2px solid #e0e3ed;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.2s;
        }

        #apiKeyInput:focus {
            outline: none;
            border-color: #533483;
        }

        #saveApiKey {
            padding: 9px 20px;
            background: #533483;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: background 0.2s;
            white-space: nowrap;
        }

        #saveApiKey:hover { background: #0f3460; }

        .api-status {
            font-size: 0.8rem;
            color: #888;
            width: 100%;
        }

        .api-status.success { color: #27ae60; font-weight: 500; }
        .api-status.error { color: #e74c3c; }

        .content-section {
            padding: 28px 30px;
        }

        /* Examples */
        .examples-section {
            margin-bottom: 24px;
        }

        .section-label {
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: #888;
            margin-bottom: 10px;
        }

        .examples-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .example-chip {
            background: #f7f8fc;
            border: 1.5px solid #e0e3ed;
            border-radius: 10px;
            padding: 10px 14px;
            font-size: 0.82rem;
            color: #333;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            line-height: 1.4;
        }

        .example-chip:hover {
            border-color: #533483;
            background: #f0edf8;
            color: #533483;
        }

        .example-chip:last-child {
            grid-column: 1 / -1;
        }

        /* Query input */
        .query-area {
            margin-bottom: 16px;
        }

        .query-textarea {
            width: 100%;
            min-height: 100px;
            padding: 14px 16px;
            border: 2px solid #e0e3ed;
            border-radius: 12px;
            font-size: 0.95rem;
            font-family: inherit;
            line-height: 1.5;
            resize: vertical;
            transition: border-color 0.2s;
            color: #222;
        }

        .query-textarea:focus {
            outline: none;
            border-color: #533483;
        }

        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #e94560, #c0392b);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: opacity 0.2s, transform 0.1s;
            letter-spacing: 0.3px;
            margin-bottom: 26px;
        }

        .calculate-btn:hover:not(:disabled) {
            opacity: 0.92;
            transform: translateY(-1px);
        }

        .calculate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* Output panels */
        .output-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .output-panel {
            border-radius: 12px;
            overflow: hidden;
            border: 1.5px solid #e0e3ed;
        }

        .panel-header {
            padding: 12px 16px;
            font-weight: 700;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-header.code-header {
            background: #1e1e2e;
            color: #cdd6f4;
            border-bottom: 1px solid #313244;
        }

        .panel-header.result-header {
            background: #f0fdf4;
            color: #166534;
            border-bottom: 1.5px solid #bbf7d0;
        }

        .panel-header.explanation-header {
            background: #eff6ff;
            color: #1e40af;
            border-bottom: 1.5px solid #bfdbfe;
        }

        /* Code block */
        .code-block {
            background: #1e1e2e;
            color: #cdd6f4;
            padding: 18px;
            font-family: 'Cascadia Code', 'Fira Code', 'Courier New', monospace;
            font-size: 0.82rem;
            line-height: 1.65;
            white-space: pre-wrap;
            overflow-x: auto;
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto;
        }

        /* Execution output */
        .exec-output {
            background: #fafffe;
            padding: 18px;
            font-family: 'Cascadia Code', 'Fira Code', 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.65;
            white-space: pre-wrap;
            color: #064e3b;
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto;
        }

        /* Explanation */
        .explanation-panel {
            margin-top: 20px;
            border-radius: 12px;
            overflow: hidden;
            border: 1.5px solid #bfdbfe;
        }

        .explanation-body {
            background: white;
            padding: 18px 20px;
            font-size: 0.92rem;
            line-height: 1.7;
            color: #1e293b;
        }

        /* Status row */
        .status-row {
            display: flex;
            gap: 10px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .status-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-chip.ok {
            background: #d1fae5;
            color: #065f46;
        }

        .status-chip.warn {
            background: #fef3c7;
            color: #92400e;
        }

        .status-chip.info {
            background: #dbeafe;
            color: #1e40af;
        }

        /* Placeholder */
        .placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 300px;
            color: #aaa;
            font-size: 0.9rem;
            gap: 10px;
        }

        .placeholder-icon {
            font-size: 2.5rem;
            opacity: 0.4;
        }

        /* Spinner */
        .spinner {
            width: 28px;
            height: 28px;
            border: 3px solid #e0e3ed;
            border-top-color: #533483;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 12px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            color: #666;
            font-size: 0.9rem;
        }

        /* Grade table hint */
        .grade-ref {
            margin-bottom: 20px;
            background: #fefce8;
            border: 1.5px solid #fde68a;
            border-radius: 10px;
            padding: 12px 16px;
        }

        .grade-ref-title {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #92400e;
            margin-bottom: 8px;
        }

        .grade-table {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .grade-item {
            background: white;
            border: 1px solid #fde68a;
            border-radius: 6px;
            padding: 4px 10px;
            font-size: 0.78rem;
            color: #78350f;
            font-weight: 600;
        }

        @media (max-width: 700px) {
            .output-section { grid-template-columns: 1fr; }
            .examples-grid { grid-template-columns: 1fr; }
            .example-chip:last-child { grid-column: auto; }
            .header h1 { font-size: 1.6rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìê WAM & Study Load Calculator</h1>
            <p>Describe your semester ‚Äî Gemini writes and runs the Python for you</p>
            <div class="badge-row">
                <span class="badge">WAM / GPA</span>
                <span class="badge">Credit Points</span>
                <span class="badge">HD ¬∑ D ¬∑ C ¬∑ P ¬∑ F</span>
                <span class="badge">Swotvac Planner</span>
                <span class="badge">Code Execution</span>
            </div>
        </div>

        <div class="api-key-section">
            <label for="apiKeyInput">Google AI API Key</label>
            <input type="password" id="apiKeyInput" placeholder="AIza..." maxlength="200">
            <button id="saveApiKey">Save Key</button>
            <div class="api-status" id="apiStatus">Enter your Google AI API key to get started</div>
        </div>

        <div class="content-section">

            <div class="grade-ref">
                <div class="grade-ref-title">Australian Grade Scale Reference</div>
                <div class="grade-table">
                    <span class="grade-item">HD ‚â• 85</span>
                    <span class="grade-item">D 75‚Äì84</span>
                    <span class="grade-item">C 65‚Äì74</span>
                    <span class="grade-item">P 50‚Äì64</span>
                    <span class="grade-item">F &lt; 50</span>
                    <span class="grade-item">GPA 7-pt scale</span>
                    <span class="grade-item">WAM = weighted avg mark</span>
                </div>
            </div>

            <div class="examples-section">
                <div class="section-label">Example Queries ‚Äî click to load</div>
                <div class="examples-grid">
                    <button class="example-chip" data-query="I have 4 units at 6 credit points each. I'm averaging 72 (Credit). What WAM do I need in the remaining assessments to hit 75 (Distinction)?">
                        üìä I have 4 units at 6 CP each, averaging 72. What WAM do I need in remaining assessments to hit 75?
                    </button>
                    <button class="example-chip" data-query="My COMP1010 has: Assignment 1 (20%, I got 16/20), Mid-sem test (30%, I got 24/30), Final exam (50%, not yet done). What do I need in the final to pass? To get a D? An HD?">
                        üéØ COMP1010: Assign 1 20% got 16, Mid-sem 30% got 24, Final 50% remaining. What do I need to pass / get D / HD?
                    </button>
                    <button class="example-chip" data-query="I have 18 contact hours per week. The recommended study is 2 hours per hour of class. I also work 16 hours per week. How many free hours do I have left for study and leisure each week? Assume 112 waking hours per week.">
                        ‚è∞ 18 contact hours/wk, recommended 2hr study per class hour, work 16hr/wk. How many free hours remain?
                    </button>
                    <button class="example-chip" data-query="Generate a swotvac study hours plan for 5 days with 4 exams. Weight study time by unit difficulty: MATH (hardest, weight 4), COMP (weight 3), PSYC (weight 2), HIST (easiest, weight 1). Total 8 hours of study per day.">
                        üìÖ Swotvac 5 days, 4 exams (MATH hardest, HIST easiest). Allocate 8 hrs/day weighted by difficulty.
                    </button>
                    <button class="example-chip" data-query="Calculate my GPA on the 7-point Australian scale given these unit marks: 82 (6 CP), 67 (6 CP), 71 (6 CP), 55 (6 CP). Show each grade band, the GPA points for each, and the final weighted GPA.">
                        üèÜ Calculate my 7-point GPA for marks: 82, 67, 71, 55 (all 6 CP). Show grade bands and final GPA.
                    </button>
                </div>
            </div>

            <div class="query-area">
                <div class="section-label">Your Query</div>
                <textarea class="query-textarea" id="queryInput" placeholder="Describe your units, marks, credit points, or study situation. E.g. 'I have 3 units: COMP1010 (6CP, 68 so far), MATH1001 (6CP, 55 so far), PSYC1002 (3CP, 80 so far). Calculate my WAM and what I need to lift it above 70.'"></textarea>
            </div>

            <button class="calculate-btn" id="calculateBtn" disabled>
                ‚ñ∂ Generate &amp; Run Python ‚Äî Calculate
            </button>

            <div class="output-section">
                <div class="output-panel" id="codePanel">
                    <div class="panel-header code-header">
                        <span>‚öô</span> Generated Python Code
                    </div>
                    <div class="code-block" id="codeOutput">
                        <div class="placeholder">
                            <span class="placeholder-icon">üêç</span>
                            Generated Python code will appear here
                        </div>
                    </div>
                </div>

                <div class="output-panel" id="resultPanel">
                    <div class="panel-header result-header">
                        <span>‚úÖ</span> Execution Output
                    </div>
                    <div class="exec-output" id="execOutput">
                        <div class="placeholder">
                            <span class="placeholder-icon">üìã</span>
                            Calculation results will appear here
                        </div>
                    </div>
                </div>
            </div>

            <div class="explanation-panel" id="explanationPanel" style="display:none;">
                <div class="panel-header explanation-header">
                    <span>üí¨</span> Gemini's Explanation
                </div>
                <div class="explanation-body" id="explanationOutput"></div>
            </div>

            <div class="status-row" id="statusRow" style="display:none;"></div>
        </div>
    </div>

    <script type="module">
        import { GoogleGenAI } from "https://esm.sh/@google/genai@latest";

        let apiKey = localStorage.getItem('googleAiApiKey') || '';
        let ai = null;

        const apiKeyInput   = document.getElementById('apiKeyInput');
        const saveApiKeyBtn = document.getElementById('saveApiKey');
        const apiStatus     = document.getElementById('apiStatus');
        const queryInput    = document.getElementById('queryInput');
        const calculateBtn  = document.getElementById('calculateBtn');
        const codeOutput    = document.getElementById('codeOutput');
        const execOutput    = document.getElementById('execOutput');
        const explanationPanel = document.getElementById('explanationPanel');
        const explanationOutput = document.getElementById('explanationOutput');
        const statusRow     = document.getElementById('statusRow');

        if (apiKey) {
            apiKeyInput.value = apiKey;
            initAI();
        }

        function initAI() {
            try {
                ai = new GoogleGenAI({ apiKey });
                apiStatus.textContent = '‚úÖ API key saved ‚Äî ready to calculate';
                apiStatus.className = 'api-status success';
                calculateBtn.disabled = false;
            } catch {
                apiStatus.textContent = '‚ùå Could not initialise with that API key';
                apiStatus.className = 'api-status error';
                calculateBtn.disabled = true;
            }
        }

        saveApiKeyBtn.addEventListener('click', () => {
            apiKey = apiKeyInput.value.trim();
            if (apiKey) {
                localStorage.setItem('googleAiApiKey', apiKey);
                initAI();
            } else {
                apiStatus.textContent = 'Please enter a valid API key';
                apiStatus.className = 'api-status error';
            }
        });

        // Example chips
        document.querySelectorAll('.example-chip').forEach(chip => {
            chip.addEventListener('click', () => {
                queryInput.value = chip.dataset.query;
                queryInput.focus();
            });
        });

        calculateBtn.addEventListener('click', async () => {
            if (!ai) { alert('Please save your API key first.'); return; }
            const query = queryInput.value.trim();
            if (!query) { alert('Please enter a query or pick an example.'); return; }

            calculateBtn.disabled = true;
            calculateBtn.textContent = '‚è≥ Running‚Ä¶';
            statusRow.style.display = 'none';
            explanationPanel.style.display = 'none';

            codeOutput.innerHTML = `<div class="loading-state"><div class="spinner"></div>Gemini is writing the Python code‚Ä¶</div>`;
            execOutput.innerHTML = `<div class="loading-state"><div class="spinner"></div>Waiting for execution results‚Ä¶</div>`;

            try {
                await runCalculation(query);
            } catch (err) {
                console.error(err);
                codeOutput.textContent = `# Error: ${err.message}`;
                execOutput.textContent = 'Could not complete the calculation. Check the console for details.';
            }

            calculateBtn.disabled = false;
            calculateBtn.textContent = '‚ñ∂ Generate & Run Python ‚Äî Calculate';
        });

        async function runCalculation(query) {
            const systemContext = `You are a helpful assistant for Australian university students.
When asked about marks, grades, WAM, GPA, study hours, or academic planning, write and execute Python code to compute the answer precisely.
Use Australian university conventions:
- HD (High Distinction) ‚â• 85, D (Distinction) 75‚Äì84, C (Credit) 65‚Äì74, P (Pass) 50‚Äì64, F (Fail) < 50
- WAM = weighted average mark (weighted by credit points)
- GPA uses the 7-point Australian scale: HD=7, D=6, C=5, P=4, F=0
- Credit points (CP) indicate unit weight
- "Swotvac" is the study vacation before exams
Always print clear, labelled output with units. Use print() statements throughout so results are visible.`;

            const response = await ai.models.generateContent({
                model: 'gemini-2.5-flash',
                contents: [{ role: 'user', parts: [{ text: query }] }],
                config: {
                    systemInstruction: systemContext,
                    tools: [{ codeExecution: {} }]
                }
            });

            const parts = response?.candidates?.[0]?.content?.parts || [];
            displayResults(parts);
        }

        function displayResults(parts) {
            let code = '';
            let output = '';
            let explanation = '';

            parts.forEach(part => {
                if (part.text) {
                    explanation += part.text;
                }
                if (part.executableCode?.code) {
                    code += part.executableCode.code + '\n';
                }
                if (part.codeExecutionResult?.output) {
                    output += part.codeExecutionResult.output;
                }
            });

            // Code panel
            if (code.trim()) {
                codeOutput.textContent = code.trim();
            } else {
                codeOutput.innerHTML = `<div class="placeholder"><span class="placeholder-icon">‚ö†Ô∏è</span>No Python code was generated</div>`;
            }

            // Execution output panel
            if (output.trim()) {
                execOutput.textContent = output.trim();
            } else {
                execOutput.innerHTML = `<div class="placeholder"><span class="placeholder-icon">‚ö†Ô∏è</span>No execution output ‚Äî code may not have printed results</div>`;
            }

            // Explanation
            const cleanExplanation = explanation.trim();
            if (cleanExplanation) {
                explanationOutput.innerHTML = formatExplanation(cleanExplanation);
                explanationPanel.style.display = 'block';
            }

            // Status chips
            const chips = [];
            chips.push({ cls: code.trim() ? 'ok' : 'warn', label: code.trim() ? '‚úÖ Code generated' : '‚ö†Ô∏è No code generated' });
            chips.push({ cls: output.trim() ? 'ok' : 'warn', label: output.trim() ? '‚úÖ Executed on Gemini servers' : '‚ö†Ô∏è No execution output' });
            chips.push({ cls: 'info', label: 'üêç Python ¬∑ Gemini 2.5 Flash' });

            statusRow.innerHTML = chips.map(c =>
                `<span class="status-chip ${c.cls}">${c.label}</span>`
            ).join('');
            statusRow.style.display = 'flex';
        }

        function formatExplanation(text) {
            // Basic markdown-ish formatting: bold **x**, newlines ‚Üí <br>
            return text
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>');
        }
    </script>
</body>
</html>
