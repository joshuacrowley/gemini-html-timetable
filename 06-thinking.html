<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uni Timetable Clash Resolver â€” Gemini Thinking</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0d1b2a;
            min-height: 100vh;
            padding: 24px 16px;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
        }

        /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .header {
            text-align: center;
            padding: 40px 30px 32px;
            margin-bottom: 20px;
        }

        .header-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 20px;
            padding: 6px 16px;
            font-size: 0.78rem;
            color: #a8c8ff;
            letter-spacing: 0.5px;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2.4rem;
            font-weight: 700;
            color: #ffffff;
            line-height: 1.15;
            margin-bottom: 12px;
        }

        .header h1 span {
            color: #4d90fe;
        }

        .header p {
            color: #8899aa;
            font-size: 1rem;
            max-width: 560px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* â”€â”€ Card base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .card {
            background: #ffffff;
            border-radius: 14px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.18);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .card-header {
            padding: 18px 24px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-header h2 {
            font-size: 1rem;
            font-weight: 600;
            color: #1a1a2e;
        }

        .card-body {
            padding: 22px 24px;
        }

        /* â”€â”€ API Key â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .api-key-row {
            display: flex;
            gap: 10px;
        }

        .api-key-row input {
            flex: 1;
            padding: 11px 14px;
            border: 2px solid #e8eaed;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.2s;
            color: #1a1a2e;
        }

        .api-key-row input:focus {
            outline: none;
            border-color: #4d90fe;
        }

        .btn-primary {
            padding: 11px 22px;
            background: #4d90fe;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: background 0.2s;
            white-space: nowrap;
        }

        .btn-primary:hover { background: #3a7cf0; }
        .btn-primary:disabled { background: #b0bec5; cursor: not-allowed; }

        .api-status {
            margin-top: 10px;
            font-size: 0.83rem;
            color: #888;
        }
        .api-status.ok { color: #2e7d32; }
        .api-status.err { color: #c62828; }

        /* â”€â”€ Settings row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .settings-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .field-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .field-group label {
            font-size: 0.83rem;
            font-weight: 600;
            color: #555;
            text-transform: uppercase;
            letter-spacing: 0.4px;
        }

        .field-group select,
        .field-group input[type="range"] {
            padding: 10px 12px;
            border: 2px solid #e8eaed;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #1a1a2e;
            background: white;
            cursor: pointer;
        }

        .field-group select:focus { outline: none; border-color: #4d90fe; }

        .field-group input[type="range"] {
            padding: 6px 0;
            border: none;
            cursor: pointer;
            accent-color: #4d90fe;
        }

        .budget-display {
            font-size: 0.82rem;
            color: #666;
            margin-top: 2px;
        }

        /* â”€â”€ Timetable input â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .scenario-label {
            font-size: 0.83rem;
            font-weight: 600;
            color: #555;
            text-transform: uppercase;
            letter-spacing: 0.4px;
            margin-bottom: 8px;
        }

        .scenario-hint {
            font-size: 0.82rem;
            color: #888;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        textarea#scenarioInput {
            width: 100%;
            min-height: 320px;
            padding: 14px;
            border: 2px solid #e8eaed;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            color: #1a1a2e;
            resize: vertical;
            transition: border-color 0.2s;
        }

        textarea#scenarioInput:focus {
            outline: none;
            border-color: #4d90fe;
        }

        /* â”€â”€ Solve button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .solve-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #1565c0 0%, #4d90fe 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s, transform 0.1s;
            letter-spacing: 0.2px;
            margin-top: 4px;
        }

        .solve-btn:hover { opacity: 0.92; transform: translateY(-1px); }
        .solve-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        /* â”€â”€ Thinking panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .thinking-card {
            background: #f7f8fc;
            border-radius: 14px;
            border: 1px solid #e2e5f0;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .thinking-toggle {
            width: 100%;
            padding: 16px 22px;
            background: none;
            border: none;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            text-align: left;
            transition: background 0.15s;
        }

        .thinking-toggle:hover { background: #eef0f8; }

        .thinking-toggle .toggle-icon {
            font-size: 1.1rem;
            transition: transform 0.25s;
        }

        .thinking-toggle.open .toggle-icon {
            transform: rotate(90deg);
        }

        .thinking-toggle-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #4a5568;
            flex: 1;
        }

        .thinking-token-count {
            font-size: 0.78rem;
            color: #888;
            background: #e8eaed;
            padding: 3px 10px;
            border-radius: 12px;
        }

        .thinking-body {
            display: none;
            padding: 0 22px 20px;
        }

        .thinking-body.open { display: block; }

        .thinking-content {
            font-family: 'Courier New', monospace;
            font-size: 0.82rem;
            color: #4a5568;
            white-space: pre-wrap;
            line-height: 1.7;
            max-height: 450px;
            overflow-y: auto;
            background: #ffffff;
            border: 1px solid #e2e5f0;
            border-radius: 8px;
            padding: 16px;
        }

        /* â”€â”€ Result panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .result-card {
            background: #ffffff;
            border-radius: 14px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.18);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .result-header {
            background: linear-gradient(135deg, #1565c0 0%, #1976d2 100%);
            padding: 18px 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .result-header h2 {
            color: white;
            font-size: 1rem;
            font-weight: 600;
        }

        .result-body {
            padding: 24px;
            color: #2d3748;
            font-size: 0.95rem;
            line-height: 1.8;
            white-space: pre-wrap;
            min-height: 80px;
        }

        /* â”€â”€ Loading states â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .status-message {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 20px 24px;
            color: #666;
            font-size: 0.9rem;
            font-style: italic;
        }

        .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid #e0e0e0;
            border-top-color: #4d90fe;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            flex-shrink: 0;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden { display: none !important; }

        /* â”€â”€ Timetable grid in output â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .timetable-output table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
            font-size: 0.88rem;
        }

        .timetable-output th {
            background: #e8f0fe;
            color: #1565c0;
            padding: 10px 14px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #c5d8ff;
        }

        .timetable-output td {
            padding: 10px 14px;
            border-bottom: 1px solid #f0f0f0;
            color: #2d3748;
        }

        .timetable-output tr:hover td { background: #f7fbff; }

        /* â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .footer {
            text-align: center;
            color: #445;
            font-size: 0.78rem;
            padding-bottom: 32px;
            opacity: 0.6;
        }

        /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media (max-width: 640px) {
            .header h1 { font-size: 1.7rem; }
            .settings-row { grid-template-columns: 1fr; }
            .api-key-row { flex-direction: column; }
            .api-key-row input { min-width: 0; }
        }
    </style>
</head>
<body>
    <div class="container">

        <!-- Header -->
        <div class="header">
            <div class="header-badge">
                <span>ğŸ§ </span> Gemini Extended Thinking
            </div>
            <h1>Uni Timetable<br><span>Clash Resolver</span></h1>
            <p>Describe your units and constraints. Gemini's step-by-step reasoning works out a clash-free semester timetable.</p>
        </div>

        <!-- API Key -->
        <div class="card">
            <div class="card-header">
                <span>ğŸ”‘</span>
                <h2>Google AI API Key</h2>
            </div>
            <div class="card-body">
                <div class="api-key-row">
                    <input type="password" id="apiKeyInput" placeholder="Paste your Google AI Studio API keyâ€¦" autocomplete="off">
                    <button class="btn-primary" id="saveApiKey">Save Key</button>
                </div>
                <div class="api-status" id="apiStatus">Enter your API key from <a href="https://aistudio.google.com/apikey" target="_blank">aistudio.google.com</a> to get started.</div>
            </div>
        </div>

        <!-- Settings -->
        <div class="card">
            <div class="card-header">
                <span>âš™ï¸</span>
                <h2>Model Settings</h2>
            </div>
            <div class="card-body">
                <div class="settings-row">
                    <div class="field-group">
                        <label>Model</label>
                        <select id="modelSelect">
                            <option value="gemini-2.5-flash">Gemini 2.5 Flash (Recommended)</option>
                            <option value="gemini-2.5-pro">Gemini 2.5 Pro (Deepest reasoning)</option>
                        </select>
                    </div>
                    <div class="field-group">
                        <label>Thinking Budget â€” <span id="budgetLabel">8 000</span> tokens</label>
                        <input type="range" id="thinkingBudget" min="1024" max="24576" step="1024" value="8192">
                        <div class="budget-display" id="budgetHint">More tokens = deeper reasoning, but slower response</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scenario input -->
        <div class="card">
            <div class="card-header">
                <span>ğŸ“‹</span>
                <h2>Your Units &amp; Constraints</h2>
            </div>
            <div class="card-body">
                <p class="scenario-hint">
                    Describe the units you want to enrol in, the available class times (lectures, tutes, workshops), and any personal constraints. A realistic example is pre-filled below â€” edit it to match your situation.
                </p>
                <textarea id="scenarioInput">== SEMESTER 1 ENROLMENT â€” UNIVERSITY OF SOUTHERN QUEENSLAND ==

UNITS I WANT TO ENROL IN:
  1. COMP1010 â€“ Introduction to Programming
  2. MATH1001 â€“ Calculus & Linear Algebra
  3. ECON1010 â€“ Principles of Microeconomics
  4. HIST1205 â€“ Modern Australian History (breadth)

AVAILABLE CLASS TIMES:

COMP1010 â€“ Introduction to Programming
  Lecture A:   Monday     10:00â€“12:00   (Engineering Building, Room E201)
  Lecture B:   Wednesday  14:00â€“16:00   (Engineering Building, Room E201)
  Tutorial 1:  Tuesday    09:00â€“10:00   (Computer Lab CL1)
  Tutorial 2:  Tuesday    13:00â€“14:00   (Computer Lab CL1)
  Tutorial 3:  Thursday   11:00â€“12:00   (Computer Lab CL1)
  Tutorial 4:  Friday     10:00â€“11:00   (Computer Lab CL1)

MATH1001 â€“ Calculus & Linear Algebra
  Lecture A:   Monday     12:00â€“14:00   (Maths Building, Room M101)
  Lecture B:   Wednesday  10:00â€“12:00   (Maths Building, Room M101)
  Tutorial 1:  Tuesday    10:00â€“11:00   (Maths Building, Room M201)
  Tutorial 2:  Wednesday  13:00â€“14:00   (Maths Building, Room M201)
  Tutorial 3:  Thursday   14:00â€“15:00   (Maths Building, Room M201)
  Tutorial 4:  Friday     11:00â€“12:00   (Maths Building, Room M201)

ECON1010 â€“ Principles of Microeconomics
  Lecture A:   Tuesday    12:00â€“14:00   (Humanities Building, Room H105)
  Lecture B:   Thursday   10:00â€“12:00   (Humanities Building, Room H105)
  Tutorial 1:  Monday     14:00â€“15:00   (Humanities Building, Room H201)
  Tutorial 2:  Wednesday  09:00â€“10:00   (Humanities Building, Room H201)
  Tutorial 3:  Friday     13:00â€“14:00   (Humanities Building, Room H201)

HIST1205 â€“ Modern Australian History
  Lecture A:   Tuesday    10:00â€“12:00   (Humanities Building, Room H107)
  Lecture B:   Thursday   13:00â€“15:00   (Humanities Building, Room H107)
  Tutorial 1:  Monday     15:00â€“16:00   (Humanities Building, Room H202)
  Tutorial 2:  Wednesday  15:00â€“16:00   (Humanities Building, Room H202)
  Tutorial 3:  Friday     09:00â€“10:00   (Humanities Building, Room H202)

MY PERSONAL CONSTRAINTS:
  â€¢ I work a part-time shift at a cafÃ© every Thursday from 13:00â€“18:00. I cannot attend any class on Thursday afternoon.
  â€¢ I prefer not to start before 09:00 or finish after 17:00.
  â€¢ Monday at 14:00â€“16:00 I have a standing commitment (dentist + physio, every fortnight â€” treat as unavailable to be safe).
  â€¢ I live 40 minutes from campus by bus, so avoid back-to-back classes across different buildings with less than 15 min gap.
  â€¢ I'd like Fridays to be as light as possible (ideally at most one class).
  â€¢ I'm registered on the Toowoomba campus â€” all classes must be at the same campus (no Ipswich/Online substitution).

GOAL: Find one clash-free combination of (Lecture + Tutorial) for each unit that satisfies all constraints. List the final weekly timetable in a clear day-by-day schedule and explain any trade-offs.</textarea>

                <button class="solve-btn" id="solveBtn" disabled>
                    ğŸ“ Resolve My Timetable
                </button>
            </div>
        </div>

        <!-- Thinking panel (hidden until response) -->
        <div class="thinking-card hidden" id="thinkingCard">
            <button class="thinking-toggle" id="thinkingToggle">
                <span class="toggle-icon">â–¶</span>
                <span class="thinking-toggle-label">ğŸ§  AI Reasoning Process</span>
                <span class="thinking-token-count" id="thinkingTokenCount"></span>
            </button>
            <div class="thinking-body" id="thinkingBody">
                <div class="thinking-content" id="thinkingContent"></div>
            </div>
        </div>

        <!-- Result panel (hidden until response) -->
        <div class="result-card hidden" id="resultCard">
            <div class="result-header">
                <span>ğŸ“…</span>
                <h2>Recommended Clash-Free Timetable</h2>
            </div>
            <div class="result-body" id="resultBody"></div>
        </div>

        <!-- Loading state (hidden by default) -->
        <div class="card hidden" id="loadingCard">
            <div class="status-message">
                <div class="spinner"></div>
                <span id="loadingMessage">Gemini is reasoning through your timetable constraintsâ€¦</span>
            </div>
        </div>

        <div class="footer">Gemini API Â· Extended Thinking Â· @google/genai JS SDK</div>
    </div>

    <script type="module">
        import { GoogleGenAI } from "https://esm.sh/@google/genai@latest";

        // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        let apiKey = localStorage.getItem('googleAiApiKey') || '';
        let ai = null;

        // â”€â”€ Element refs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const apiKeyInput      = document.getElementById('apiKeyInput');
        const saveApiKeyBtn    = document.getElementById('saveApiKey');
        const apiStatus        = document.getElementById('apiStatus');
        const modelSelect      = document.getElementById('modelSelect');
        const thinkingBudget   = document.getElementById('thinkingBudget');
        const budgetLabel      = document.getElementById('budgetLabel');
        const scenarioInput    = document.getElementById('scenarioInput');
        const solveBtn         = document.getElementById('solveBtn');
        const thinkingCard     = document.getElementById('thinkingCard');
        const thinkingToggle   = document.getElementById('thinkingToggle');
        const thinkingBody     = document.getElementById('thinkingBody');
        const thinkingContent  = document.getElementById('thinkingContent');
        const thinkingTokenCount = document.getElementById('thinkingTokenCount');
        const resultCard       = document.getElementById('resultCard');
        const resultBody       = document.getElementById('resultBody');
        const loadingCard      = document.getElementById('loadingCard');
        const loadingMessage   = document.getElementById('loadingMessage');

        // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        if (apiKey) {
            apiKeyInput.value = apiKey;
            initAI();
        }

        function initAI() {
            try {
                ai = new GoogleGenAI({ apiKey });
                apiStatus.textContent = 'âœ… API key saved â€” ready to resolve timetables!';
                apiStatus.className = 'api-status ok';
                solveBtn.disabled = false;
            } catch {
                apiStatus.textContent = 'âŒ Could not initialise the SDK â€” check your API key.';
                apiStatus.className = 'api-status err';
                ai = null;
                solveBtn.disabled = true;
            }
        }

        saveApiKeyBtn.addEventListener('click', () => {
            apiKey = apiKeyInput.value.trim();
            if (!apiKey) {
                apiStatus.textContent = 'Please paste your API key first.';
                apiStatus.className = 'api-status err';
                return;
            }
            localStorage.setItem('googleAiApiKey', apiKey);
            initAI();
        });

        // â”€â”€ Budget slider label â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        thinkingBudget.addEventListener('input', () => {
            budgetLabel.textContent = Number(thinkingBudget.value).toLocaleString();
        });

        // â”€â”€ Thinking panel toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        thinkingToggle.addEventListener('click', () => {
            const open = thinkingBody.classList.toggle('open');
            thinkingToggle.classList.toggle('open', open);
        });

        // â”€â”€ Main solve action â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        solveBtn.addEventListener('click', async () => {
            if (!ai) { alert('Enter your API key first.'); return; }

            const scenario = scenarioInput.value.trim();
            if (!scenario) { alert('Please describe your units and constraints.'); return; }

            // Reset UI
            solveBtn.disabled = true;
            thinkingCard.classList.add('hidden');
            resultCard.classList.add('hidden');
            loadingCard.classList.remove('hidden');
            loadingMessage.textContent = 'Gemini is reasoning through your timetable constraintsâ€¦';

            try {
                const model  = modelSelect.value;
                const budget = parseInt(thinkingBudget.value, 10);

                const systemPrompt = `You are an expert Australian university enrolment advisor. \
Your task is to analyse the student's unit options and personal constraints, \
then recommend a clash-free weekly timetable for the semester. \
Use correct Australian university terminology (units, lectures, tutorials/tutes, \
workshops, semester weeks, WAM, SWOTVAC, etc.). \
Work through every possible combination systematically, eliminate clashes, \
then eliminate options that violate personal constraints, and present the best \
remaining combination. Format the final timetable as a clear day-by-day schedule \
with unit name, session type, time, and room. Highlight any necessary trade-offs.`;

                const userPrompt = scenario;

                const response = await ai.models.generateContent({
                    model,
                    contents: [
                        {
                            role: 'user',
                            parts: [{ text: `${systemPrompt}\n\n---\n\n${userPrompt}` }]
                        }
                    ],
                    config: {
                        thinkingConfig: {
                            includeThoughts: true,
                            thinkingBudget: budget
                        }
                    }
                });

                // â”€â”€ Separate thoughts from final answer â”€â”€â”€â”€â”€
                let thoughts = '';
                let answer   = '';

                for (const part of response.candidates[0].content.parts) {
                    if (!part.text) continue;
                    if (part.thought) {
                        thoughts += part.text + '\n\n';
                    } else {
                        answer += part.text;
                    }
                }

                loadingCard.classList.add('hidden');

                // Show thinking panel
                if (thoughts.trim()) {
                    const wordCount = thoughts.trim().split(/\s+/).length;
                    thinkingTokenCount.textContent = `~${wordCount.toLocaleString()} words of reasoning`;
                    thinkingContent.textContent = thoughts.trim();
                    thinkingCard.classList.remove('hidden');
                    // Auto-expand on first load
                    thinkingBody.classList.add('open');
                    thinkingToggle.classList.add('open');
                }

                // Show result
                resultBody.textContent = answer.trim() || '(No final answer returned â€” try increasing the thinking budget.)';
                resultCard.classList.remove('hidden');

            } catch (err) {
                loadingCard.classList.add('hidden');
                resultBody.textContent = `Error: ${err.message}\n\nCheck your API key and ensure the selected model supports extended thinking.`;
                resultCard.classList.remove('hidden');
                console.error(err);
            }

            solveBtn.disabled = false;
        });
    </script>
</body>
</html>
