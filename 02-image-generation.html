<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Timetable Visualiser â€” Gemini Imagen</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            padding: 24px 16px;
        }

        .container {
            max-width: 860px;
            margin: 0 auto;
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 24px 64px rgba(0, 0, 0, 0.35);
            overflow: hidden;
        }

        /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .header {
            background: linear-gradient(135deg, #6c63ff 0%, #a855f7 100%);
            color: #fff;
            padding: 32px 36px 28px;
        }

        .header-top {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 8px;
        }

        .header-icon {
            font-size: 2rem;
            line-height: 1;
        }

        .header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            letter-spacing: -0.3px;
        }

        .header p {
            opacity: 0.88;
            font-size: 1rem;
            margin-left: 48px;
        }

        /* â”€â”€ Paid-API notice â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .paid-notice {
            background: #fffbeb;
            border-left: 4px solid #f59e0b;
            padding: 14px 20px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            font-size: 0.9rem;
            color: #78350f;
        }

        .paid-notice .icon {
            font-size: 1.1rem;
            flex-shrink: 0;
            margin-top: 1px;
        }

        .paid-notice strong {
            display: block;
            margin-bottom: 3px;
            color: #92400e;
        }

        .paid-notice a {
            color: #b45309;
            font-weight: 600;
        }

        /* â”€â”€ API key section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .api-key-section {
            padding: 20px 28px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .api-key-label {
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            color: #64748b;
            margin-bottom: 8px;
        }

        .api-key-group {
            display: flex;
            gap: 10px;
            align-items: stretch;
        }

        #apiKeyInput {
            flex: 1;
            padding: 10px 14px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 0.92rem;
            font-family: 'Courier New', monospace;
            transition: border-color 0.2s;
            background: #fff;
        }

        #apiKeyInput:focus {
            outline: none;
            border-color: #6c63ff;
        }

        #saveApiKey {
            padding: 10px 20px;
            background: #6c63ff;
            color: #fff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.92rem;
            font-weight: 600;
            transition: background 0.2s;
            white-space: nowrap;
        }

        #saveApiKey:hover {
            background: #5b52e0;
        }

        .api-status {
            margin-top: 8px;
            font-size: 0.82rem;
            color: #94a3b8;
        }

        .api-status.success {
            color: #059669;
        }

        .api-status.error {
            color: #dc2626;
        }

        /* â”€â”€ Main content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .content-section {
            padding: 28px;
        }

        .section-label {
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            color: #64748b;
            margin-bottom: 10px;
        }

        /* â”€â”€ Example buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .examples-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 24px;
        }

        .example-btn {
            padding: 10px 12px;
            background: #f1f0ff;
            color: #4c46c2;
            border: 2px solid #c7c4f7;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.82rem;
            font-weight: 600;
            text-align: left;
            transition: all 0.18s;
            line-height: 1.4;
        }

        .example-btn:hover {
            background: #6c63ff;
            color: #fff;
            border-color: #6c63ff;
        }

        .example-btn .example-title {
            display: block;
            font-size: 0.78rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.4px;
            margin-bottom: 3px;
            opacity: 0.75;
        }

        /* â”€â”€ Schedule input â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .schedule-input-wrap {
            margin-bottom: 20px;
        }

        #scheduleInput {
            width: 100%;
            min-height: 120px;
            padding: 14px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 0.95rem;
            line-height: 1.6;
            resize: vertical;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        #scheduleInput:focus {
            outline: none;
            border-color: #6c63ff;
        }

        /* â”€â”€ Style picker â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .style-picker {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 24px;
        }

        .style-option {
            position: relative;
        }

        .style-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .style-option label {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 8px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.78rem;
            font-weight: 600;
            text-align: center;
            color: #475569;
            transition: all 0.18s;
            line-height: 1.3;
        }

        .style-option label .swatch {
            font-size: 1.4rem;
        }

        .style-option input[type="radio"]:checked + label {
            border-color: #6c63ff;
            background: #f1f0ff;
            color: #4c46c2;
        }

        .style-option label:hover {
            border-color: #a5b4fc;
            background: #f8f7ff;
        }

        /* â”€â”€ Generate button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .generate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #6c63ff 0%, #a855f7 100%);
            color: #fff;
            border: none;
            border-radius: 12px;
            font-size: 1.05rem;
            font-weight: 700;
            cursor: pointer;
            transition: opacity 0.2s, transform 0.1s;
            margin-bottom: 28px;
            letter-spacing: 0.2px;
        }

        .generate-btn:hover:not(:disabled) {
            opacity: 0.92;
            transform: translateY(-1px);
        }

        .generate-btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .generate-btn:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
        }

        /* â”€â”€ Output area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .output-section {
            background: #f8fafc;
            border-radius: 14px;
            padding: 28px;
            min-height: 360px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #e2e8f0;
            transition: border-color 0.3s;
        }

        .output-section.has-content {
            border-style: solid;
            border-color: #e2e8f0;
            align-items: flex-start;
        }

        .output-placeholder {
            text-align: center;
            color: #94a3b8;
        }

        .output-placeholder .placeholder-icon {
            font-size: 3.5rem;
            margin-bottom: 16px;
            display: block;
        }

        .output-placeholder p {
            font-size: 0.95rem;
            line-height: 1.6;
            max-width: 340px;
        }

        .loading-state {
            text-align: center;
            color: #6c63ff;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #e2e8f0;
            border-top-color: #6c63ff;
            border-radius: 50%;
            animation: spin 0.85s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-state p {
            font-size: 0.95rem;
            font-weight: 600;
        }

        .loading-state .loading-sub {
            font-size: 0.82rem;
            color: #94a3b8;
            margin-top: 6px;
            font-weight: 400;
        }

        .result-wrap {
            width: 100%;
            text-align: center;
        }

        .result-image {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            display: block;
            margin: 0 auto 20px;
        }

        .result-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .download-btn {
            padding: 10px 22px;
            background: #059669;
            color: #fff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: background 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .download-btn:hover {
            background: #047857;
        }

        .regenerate-btn {
            padding: 10px 22px;
            background: #f1f0ff;
            color: #4c46c2;
            border: 2px solid #c7c4f7;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .regenerate-btn:hover {
            background: #6c63ff;
            color: #fff;
            border-color: #6c63ff;
        }

        .error-state {
            text-align: center;
            color: #dc2626;
        }

        .error-state .error-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            display: block;
        }

        .error-state p {
            font-size: 0.92rem;
            line-height: 1.6;
            max-width: 420px;
            margin: 0 auto;
        }

        .error-state .error-detail {
            margin-top: 12px;
            padding: 12px;
            background: #fef2f2;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.82rem;
            color: #991b1b;
            text-align: left;
            word-break: break-word;
        }

        /* â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .footer {
            padding: 16px 28px;
            border-top: 1px solid #f1f5f9;
            text-align: center;
            font-size: 0.78rem;
            color: #94a3b8;
        }

        /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media (max-width: 620px) {
            .examples-grid {
                grid-template-columns: 1fr;
            }

            .style-picker {
                grid-template-columns: repeat(2, 1fr);
            }

            .api-key-group {
                flex-direction: column;
            }

            .header h1 {
                font-size: 1.4rem;
            }

            .header p {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">

        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <span class="header-icon">ğŸ“…</span>
                <h1>Weekly Timetable Visualiser</h1>
            </div>
            <p>Describe your uni schedule in plain text â€” Gemini Imagen draws it for you</p>
        </div>

        <!-- Paid API notice -->
        <div class="paid-notice">
            <span class="icon">ğŸ’³</span>
            <div>
                <strong>Paid API required</strong>
                Imagen image generation is not available on the free tier. You need a Google AI API key linked to a
                <a href="https://aistudio.google.com/apikey" target="_blank" rel="noopener">billing-enabled project</a>.
                Free-tier keys will return a permission error.
            </div>
        </div>

        <!-- API key -->
        <div class="api-key-section">
            <div class="api-key-label">Google AI API Key</div>
            <div class="api-key-group">
                <input type="password" id="apiKeyInput"
                       placeholder="AIzaâ€¦"
                       maxlength="200"
                       autocomplete="off">
                <button id="saveApiKey">Save Key</button>
            </div>
            <div class="api-status" id="apiStatus">Enter your API key above to get started</div>
        </div>

        <!-- Main content -->
        <div class="content-section">

            <!-- Quick-fill examples -->
            <div class="section-label">Quick-fill examples</div>
            <div class="examples-grid">
                <button class="example-btn" data-example="cs">
                    <span class="example-title">ğŸ’» Computer Science</span>
                    Mon: COMP2041 lecture 9â€“11am, COMP3311 lecture 2â€“4pm.
                    Tue: MATH1131 lecture 10â€“11am, COMP2041 lab 12â€“2pm.
                    Wed: COMP3311 tute 10â€“11am.
                    Thu: MATH1131 tute 9â€“10am, COMP2041 tute 3â€“4pm.
                    Fri: free day.
                </button>
                <button class="example-btn" data-example="commerce">
                    <span class="example-title">ğŸ“Š Commerce / Law</span>
                    Mon: ECON1101 lecture 8â€“9am, LAWS1052 lecture 12â€“2pm.
                    Tue: ACCT1501 lecture 10â€“12pm.
                    Wed: ECON1101 tute 11â€“12pm, ACCT1501 tute 2â€“3pm.
                    Thu: LAWS1052 seminar 9â€“11am, work shift 5â€“9pm.
                    Fri: MKTG1501 lecture 10â€“12pm.
                </button>
                <button class="example-btn" data-example="health">
                    <span class="example-title">ğŸ©º Health Sciences</span>
                    Mon: BIOL1003 lecture 9â€“10am, ANAT2111 lecture 1â€“3pm.
                    Tue: BIOL1003 prac 2â€“5pm.
                    Wed: PHYS1002 lecture 10â€“11am, ANAT2111 tute 3â€“4pm.
                    Thu: PHYS1002 prac 9amâ€“12pm, gym 5â€“6pm.
                    Fri: PSYC1001 lecture 11amâ€“1pm, part-time work 2â€“6pm.
                </button>
            </div>

            <!-- Schedule description input -->
            <div class="section-label">Your weekly schedule</div>
            <div class="schedule-input-wrap">
                <textarea id="scheduleInput"
                    placeholder="Describe your week, e.g.:
Mon: COMP1010 lecture 10â€“12pm, MATH1001 tute 2â€“3pm.
Tue: free.
Wed: ECON1010 lecture 9â€“11am, HIST1205 tute 3â€“4pm.
Thu: COMP1010 lab 2â€“4pm, work 5â€“9pm.
Fri: COMP1010 tute 10â€“11am, sport 4â€“6pm."></textarea>
            </div>

            <!-- Visual style selector -->
            <div class="section-label">Visual style</div>
            <div class="style-picker">
                <div class="style-option">
                    <input type="radio" name="visualStyle" id="style-minimal" value="minimal" checked>
                    <label for="style-minimal">
                        <span class="swatch">ğŸ—“ï¸</span>
                        Clean Minimal Grid
                    </label>
                </div>
                <div class="style-option">
                    <input type="radio" name="visualStyle" id="style-colourful" value="colourful">
                    <label for="style-colourful">
                        <span class="swatch">ğŸŒˆ</span>
                        Colourful Blocks
                    </label>
                </div>
                <div class="style-option">
                    <input type="radio" name="visualStyle" id="style-pastel" value="pastel">
                    <label for="style-pastel">
                        <span class="swatch">ğŸŒ¸</span>
                        Pastel Aesthetic
                    </label>
                </div>
                <div class="style-option">
                    <input type="radio" name="visualStyle" id="style-dark" value="dark">
                    <label for="style-dark">
                        <span class="swatch">ğŸŒ™</span>
                        Dark Mode Planner
                    </label>
                </div>
            </div>

            <!-- Generate button -->
            <button class="generate-btn" id="generateBtn" disabled>
                âœ¨ Generate Timetable Image
            </button>

            <!-- Output area -->
            <div class="output-section" id="outputSection">
                <div class="output-placeholder">
                    <span class="placeholder-icon">ğŸ–¼ï¸</span>
                    <p>Your AI-generated timetable will appear here.<br>Fill in your schedule above and click Generate.</p>
                </div>
            </div>

        </div>

        <div class="footer">
            Powered by Google Gemini Imagen &nbsp;Â·&nbsp; Images include a SynthID watermark &nbsp;Â·&nbsp;
            <a href="https://ai.google.dev/gemini-api/docs/imagen" target="_blank" rel="noopener" style="color:#94a3b8;">API docs</a>
        </div>
    </div>

    <script type="module">
        import { GoogleGenAI } from "https://esm.sh/@google/genai@latest";

        // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        let apiKey = localStorage.getItem('googleAiApiKey') || '';
        let ai = null;

        const apiKeyInput   = document.getElementById('apiKeyInput');
        const saveApiKeyBtn = document.getElementById('saveApiKey');
        const apiStatus     = document.getElementById('apiStatus');
        const scheduleInput = document.getElementById('scheduleInput');
        const generateBtn   = document.getElementById('generateBtn');
        const outputSection = document.getElementById('outputSection');

        // â”€â”€ Restore saved key â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        if (apiKey) {
            apiKeyInput.value = apiKey;
            initAI();
        }

        // â”€â”€ API key handling â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function initAI() {
            try {
                ai = new GoogleGenAI({ apiKey });
                apiStatus.textContent  = 'âœ… API key saved â€” ready to generate';
                apiStatus.className    = 'api-status success';
                generateBtn.disabled   = false;
            } catch {
                apiStatus.textContent  = 'âŒ Could not initialise with that key';
                apiStatus.className    = 'api-status error';
                generateBtn.disabled   = true;
            }
        }

        saveApiKeyBtn.addEventListener('click', () => {
            const val = apiKeyInput.value.trim();
            if (!val) {
                apiStatus.textContent = 'Please enter a valid API key';
                apiStatus.className   = 'api-status error';
                return;
            }
            apiKey = val;
            localStorage.setItem('googleAiApiKey', apiKey);
            initAI();
        });

        apiKeyInput.addEventListener('keydown', e => {
            if (e.key === 'Enter') saveApiKeyBtn.click();
        });

        // â”€â”€ Example quick-fill buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        document.querySelectorAll('.example-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // Grab the text content, strip the title span
                const titleEl = btn.querySelector('.example-title');
                const title   = titleEl ? titleEl.innerText : '';
                const full    = btn.innerText.replace(title, '').trim();
                scheduleInput.value = full;
                scheduleInput.focus();
            });
        });

        // â”€â”€ Style helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const STYLE_PROMPTS = {
            minimal: `Clean, minimal academic weekly timetable planner. White background, light grey grid lines, 
                      black and dark grey text, small coloured accent pills for each subject, 
                      generous whitespace, modern sans-serif font.`,
            colourful: `Vibrant academic weekly timetable. Each subject gets a bold, distinct solid-colour block 
                        (blue, green, orange, purple, red, teal, yellow). Clear white text labels inside blocks, 
                        crisp grid, bright cheerful design.`,
            pastel: `Soft pastel aesthetic academic planner. Gentle pastel colour blocks (blush pink, lavender, 
                     mint green, sky blue, peach). Rounded corners, elegant serif-style font, hand-drawn border 
                     feel, light and airy look.`,
            dark: `Dark mode weekly planner. Very dark charcoal background (#1a1a2e), vibrant neon-accented 
                   subject blocks (electric purple, cyan, lime, orange, magenta), crisp white text, 
                   glowing border effect on blocks, futuristic minimal aesthetic.`,
        };

        function getSelectedStyle() {
            const sel = document.querySelector('input[name="visualStyle"]:checked');
            return sel ? sel.value : 'minimal';
        }

        // â”€â”€ Build Imagen prompt â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function buildPrompt(scheduleText, style) {
            const styleDesc = STYLE_PROMPTS[style] || STYLE_PROMPTS.minimal;

            return `Create a high-quality visual weekly timetable image for an Australian university student.

SCHEDULE TO VISUALISE:
${scheduleText}

LAYOUT REQUIREMENTS:
- Landscape orientation, wide-format image
- Columns for Monday through Friday (Mon, Tue, Wed, Thu, Fri)
- Time axis running vertically on the left, from 8 AM to 9 PM in 1-hour increments
- Each class/activity shown as a labelled block spanning the correct time slot
- Block labels include: unit code (e.g. COMP2041), activity type (lecture / tute / lab / prac), and time
- If a day is "free", show it as empty with a light "Free" watermark
- Work shifts, sport, gym shown as a different subtle colour from academic blocks

VISUAL STYLE:
${styleDesc}

OUTPUT REQUIREMENTS:
- High resolution, sharp text, professional finish
- No people, no photos â€” flat graphic / illustration style only
- All text must be legible and correctly spelt`;
        }

        // â”€â”€ Generate image â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        generateBtn.addEventListener('click', async () => {
            if (!ai) { alert('Please save your API key first.'); return; }

            const schedule = scheduleInput.value.trim();
            if (!schedule) {
                scheduleInput.focus();
                scheduleInput.style.borderColor = '#dc2626';
                setTimeout(() => { scheduleInput.style.borderColor = ''; }, 2000);
                return;
            }

            const style  = getSelectedStyle();
            const prompt = buildPrompt(schedule, style);

            setLoading();

            try {
                const response = await ai.models.generateImages({
                    model: 'imagen-4.0-generate-001',
                    prompt,
                    config: {
                        numberOfImages: 1,
                        personGeneration: 'dont_allow',
                    },
                });

                const imgData = response?.generatedImages?.[0]?.image?.imageBytes;
                if (!imgData) throw new Error('No image data returned by the API.');

                displayResult(imgData, schedule);

            } catch (err) {
                displayError(err);
            }
        });

        // â”€â”€ UI states â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function setLoading() {
            generateBtn.disabled = true;
            outputSection.className = 'output-section';
            outputSection.innerHTML = `
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Generating your timetableâ€¦</p>
                    <p class="loading-sub">Imagen usually takes 10â€“20 seconds</p>
                </div>`;
        }

        function displayResult(base64Bytes, schedule) {
            generateBtn.disabled = false;
            outputSection.className = 'output-section has-content';

            const dataUrl = `data:image/png;base64,${base64Bytes}`;

            // Build a safe filename from the first line of the schedule
            const safeName = schedule.slice(0, 40).replace(/[^a-z0-9]/gi, '_').toLowerCase();
            const filename = `timetable_${safeName}.png`;

            outputSection.innerHTML = `
                <div class="result-wrap">
                    <img class="result-image" src="${dataUrl}" alt="Generated weekly timetable">
                    <div class="result-actions">
                        <a class="download-btn" href="${dataUrl}" download="${filename}">
                            â¬‡ï¸ Download PNG
                        </a>
                        <button class="regenerate-btn" id="regenBtn">ğŸ”„ Regenerate</button>
                    </div>
                </div>`;

            document.getElementById('regenBtn').addEventListener('click', () => {
                generateBtn.click();
            });
        }

        function displayError(err) {
            generateBtn.disabled = false;
            outputSection.className = 'output-section has-content';

            const msg = err?.message || String(err);

            let hint = '';
            if (msg.includes('PERMISSION_DENIED') || msg.includes('403')) {
                hint = '<br><br><strong>Hint:</strong> This usually means your API key is free-tier only. Imagen requires a billing-enabled Google Cloud project.';
            } else if (msg.includes('INVALID_ARGUMENT') || msg.includes('400')) {
                hint = '<br><br><strong>Hint:</strong> The prompt may have been blocked by safety filters. Try rephrasing your schedule description.';
            } else if (msg.includes('quota') || msg.includes('429')) {
                hint = '<br><br><strong>Hint:</strong> Rate limit or quota exceeded. Wait a moment and try again.';
            }

            outputSection.innerHTML = `
                <div class="error-state">
                    <span class="error-icon">âš ï¸</span>
                    <p>Something went wrong generating the timetable.${hint}</p>
                    <div class="error-detail">${escapeHtml(msg)}</div>
                </div>`;
        }

        function escapeHtml(str) {
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }
    </script>
</body>
</html>
